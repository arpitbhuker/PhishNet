<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>PhishNet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/static/img/logo-128.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="/static/css/style.css" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="#">
          <img
            src="/static/img/logo-128.png"
            width="28"
            height="28"
            class="d-inline-block align-top"
            alt=""
          />
          PhishNet
        </a>
      </div>
    </nav>

    <div class="container">
      <div class="card p-4 shadow-sm">
        <h4 class="card-title">ðŸ”’ Suspicious Link Analyzer</h4>
        <p class="text-muted">Enter a URL and get an instant risk score.</p>

        <div class="mb-3">
          <input
            id="urlInput"
            class="form-control"
            placeholder="https://example.com/login"
          />
        </div>
        <button id="analyzeBtn" class="btn btn-primary">Analyze</button>

        <hr />

        <div id="resultArea" style="display: none">
          <h5>Result</h5>
          <div id="scoreBadge" class="mb-2"></div>
          <div id="reasonsList"></div>
          <pre id="jsonOutput" class="mt-3 bg-dark text-white p-2"></pre>
        </div>
      </div>
    </div>

    <script>
      async function analyze(url) {
        const r = await fetch("/api/analyze", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url }),
        });
        return await r.json();
      }

      document
        .getElementById("analyzeBtn")
        .addEventListener("click", async () => {
          const url = document.getElementById("urlInput").value.trim();
          if (!url) return alert("Enter a URL");
          document.getElementById("analyzeBtn").disabled = true;
          const res = await analyze(url);
          document.getElementById("analyzeBtn").disabled = false;

          // show
          const area = document.getElementById("resultArea");
          area.style.display = "block";
          const scoreBadge = document.getElementById("scoreBadge");
          scoreBadge.innerHTML = `<span class="badge bg-info">Risk: ${res.risk_score} / 100</span> <strong>${res.label}</strong>`;
          const reasons = res.reasons || [];
          const rdiv = document.getElementById("reasonsList");
          rdiv.innerHTML =
            "<ul>" + reasons.map((x) => `<li>${x}</li>`).join("") + "</ul>";
          document.getElementById("jsonOutput").textContent = JSON.stringify(
            res,
            null,
            2
          );

          // Build Key Features Table
          const featureMap = {
            "Is valid URL": res.is_valid_url,
            HTTPS: res.https,
            "Uses IP": res.uses_ip,
            "Domain age (days)": res.domain_age_days ?? "N/A",
            Redirects: res.redirects_count ?? "N/A",
            "Forms on page": res.forms ?? "N/A",
            "External favicon": res.external_favicon,
            "SSL valid": res.ssl_valid,
          };

          let tableHTML = `
<h5 class="mt-3">Key Features</h5>
<table class="table table-striped table-hover align-middle">
  <thead class="table-dark">
    <tr><th>Feature</th><th>Value</th></tr>
  </thead>
  <tbody>
`;

          for (const [k, v] of Object.entries(featureMap)) {
            let val =
              v === true
                ? `<span class="text-success fw-bold">True</span>`
                : v === false
                ? `<span class="text-danger fw-bold">False</span>`
                : v;
            tableHTML += `<tr><td>${k}</td><td>${val}</td></tr>`;
          }

          tableHTML += `</tbody></table>`;

          const resultDiv = document.getElementById("resultArea");
          resultDiv.insertAdjacentHTML("beforeend", tableHTML);
        });
    </script>
  </body>
</html>
